<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Create</title>
<link rel="stylesheet" type="text/css"
	href="../js/easyui/themes/default/easyui.css">
<link rel="stylesheet" type="text/css"
	href="../js/easyui/themes/icon.css">
<link rel="stylesheet" type="text/css" href="../js/easyui/demo/demo.css">
<script type="text/javascript" src="../js/easyui/jquery.min.js"></script>
<script type="text/javascript" src="../js/easyui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../js/util/jquery.json.2.4.js"></script>
</head>
<body>
	<div class="easyui-panel" title="新建" style="width: 800px">
		<div style="padding: 1px 0 10px 60px">
			<form id="ff" method="post" action="create">
				<div class="easyui-panel" title="基本信息" style="width: 700px">
					<table>
						<tr>
							<td>编号:</td>
							<td><input class="easyui-validatebox" type="text"
								name="kehuNo"
								data-options="required:true,validType:['length[0,20]']"></input></td>
							<td>类别:</td>
							<td>
							<!-- <input class="easyui-validatebox" type="text"
								name="kehulbMc" readonly="readonly"></input> -->
								<select class="easyui-combotree" style="width:138px;"  
        data-options="url:'category/list',required:true,onSelect:onSelectFromTree"></select>
         </td>
							<td>省市:</td>
							<td><input class="easyui-validatebox" type="text"
								name="kehuSs"></input></td>
						</tr>
						<tr>
							<td>名称:</td>
							<td colspan="3"><input class="easyui-validatebox"
								type="text" name="kehuMc" data-options="required:true"
								style="width: 300px"></input></td>
							<td>联系人:</td>
							<td><input class="easyui-validatebox" type="text"
								name="kehuXm"></input></td>
						</tr>
					</table>
				</div>
				<div class="easyui-panel" title="通讯信息" style="width: 700px"
					data-options="collapsible:true">
					<table>
						<tr>
							<td>邮编:</td>
							<td><input class="easyui-validatebox" type="text"
								name="kehuYb"></input></td>
							<td>手机:</td>
							<td><input class="easyui-validatebox" type="text"
								name="kehuSj"></input></td>
							<td>地址:</td>
							<td><input class="easyui-validatebox" type="text"
								name="kehuDz"></input></td>
						</tr>
						<tr>
							<td>电话:</td>
							<td colspan="3"><input class="easyui-validatebox"
								type="text" name="kehuDh" style="width: 300px"
								data-options="required:true"></input></td>
							<td>传真:</td>
							<td><input class="easyui-validatebox" type="text"
								name="kehuCz"></input></td>
						</tr>
						<tr>
							<td>网址:</td>
							<td colspan="3"><input class="easyui-validatebox"
								type="text" name="kehuHt" style="width: 300px"></input></td>
							<td>邮箱:</td>
							<td><input class="easyui-validatebox" type="text"
								name="kehuEm"></input></td>
						</tr>
					</table>
				</div>
				<div class="easyui-panel" title="经营信息" style="width: 700px"
					data-options="collapsible:true">
					<table>
						<tr>
							<td>全称:</td>
							<td><input class="easyui-validatebox" type="text"
								name="kehuQc" style="width: 300px"></input></td>
							<td>法人代表:</td>
							<td><input class="easyui-validatebox" type="text"
								name="kehuFr" /></td>
						</tr>
						<tr>
							<td>银行:</td>
							<td><input class="easyui-validatebox" type="text"
								name="kehuYh" style="width: 300px" /></td>
							<td>开户帐号:</td>
							<td><input class="easyui-validatebox" type="text"
								name="kehuZh" /></td>
						</tr>
						<tr>
							<td>税号:</td>
							<td><input class="easyui-validatebox" type="text"
								name="kehuSh" style="width: 300px" /></td>
							<td>开票地址:</td>
							<td><input class="easyui-validatebox" type="text"
								name="kehuDx" /></td>
						</tr>
					</table>
				</div>
				<div class="easyui-panel" title="扩展属性" style="width: 700px">
					<table>
						<tr>
							<td>信用额度:</td>
							<td><input class="easyui-validatebox" type="text"
								name="kehuXinyushangxian" readonly="readonly" />(元)</td>
							<td>应收款余额:</td>
							<td><input class="easyui-validatebox" type="text" name=""
								readonly="readonly" /></td>
							<td>应开票余额</td>
							<td><input class="easyui-validatebox" type="text" name=""
								readonly="readonly" /></td>
						</tr>
						<tr>
							<td>备注:</td>
							<td colspan="3"><input class="easyui-validatebox"
								type="text" name="kehuBz" style="width: 300px" /></td>
							<td>是否禁用:</td>
							<td><input class="easyui-validatebox" type="text"
								name="kehuIsopen" /></td>

						</tr>
					</table>
				</div>
				<input type="hidden" name="kehulbDm" id="kehulbDm"/>
				<input type="hidden" name="kehulbMc" id="kehulbMc"/>
			</form>
		</div>
		<div style="text-align: center; padding: 5px">
			<a href="javascript:void(0)" class="easyui-linkbutton"
				onclick="submitForm()">保存</a> <a href="javascript:void(0)"
				class="easyui-linkbutton" onclick="clearForm()">清除</a>
		</div>
	</div>
	<div>
		<div id="win_detail" class="easyui-window" title="联系人"
			style="width: 820px; height: 600px"
			data-options="iconCls:'icon-search',modal:true,closed:true">
			<iframe id="iframe_detail" src="" width="100%" height="100%"
				marginheight="0" marginwidth="0" scrolling="no" frameborder="no"
				align="middle"></iframe>
		</div>
	</div>
	<script type="text/javascript">
	function onSelectFromTree(node)
	{
		$('#kehulbDm')[0].value=node.id;
		$('#kehulbMc')[0].value=node.text;
	}
	 function submitForm(){
		 $.messager.progress();
		 $('#ff').form('submit', {
			    contentType:"application/x-www-form-urlencoded; charset=utf-8",
				onSubmit: function(){
					var isValid = $(this).form('validate');
					if (!isValid){
						$.messager.progress('close');	// hide progress bar while the form is invalid
					}
					return isValid;	// return false will stop the form submission
				},
				success: function(data){
					$.messager.progress('close');	// hide progress bar while submit successfully
					if(data.indexOf("请输入用户名和密码")>-1)//未登录
					{   self.location.reload();
						return;
					}
					if(data.indexOf("Fail")>-1)//如果返回Fail
					{
						var json_data=$.secureEvalJSON(data);
						//$.messager.alert('Info', json_data.Fail, 'info');
						if(data.indexOf("此客户编号已经存在")>-1)
						{
							 $.messager.confirm(json_data.Fail, '查看已存在的记录?', function(r){
								 if (r){
									 showKehuWindow(json_data.kehuNo);
								 }
								 });
							return;
						}else if(data.indexOf("此电话号码已经存在")>-1){
							$.messager.confirm(json_data.Fail, '查看此电话号码记录?', function(r){
								 if (r){
									 showKehuWindow(json_data.kehuNo);
								 }
								 });
							return;
							}
						else
						{
							$.messager.alert('Info', json_data.Fail, 'info');
							return;
						}
							
						 return;
					}
					
					if(data.indexOf("success")>-1)//如果返回success
					{
						//showKehuWindow($.secureEvalJSON(data).success);
					//	$.messager.alert('联系人',"新建成功",'info');
						$.messager.confirm("添加成功","继续添加吗？",function(r){
							if(r)
							{
								$('#ff').form('reset');
							}
							});
					}
					
				
				}
			}); 
		 }
		 function showKehuWindow(kehuNo)
	 	{
			$('#win_detail').window('open');
			$("#iframe_detail").attr("src","detail_kehu.html?kehuNo="+kehuNo);
		}
		 function clearForm(){
		 $('#ff').form('clear');
		 }
	</script>
</body>
</html>